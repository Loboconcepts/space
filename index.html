<!DOCTYPE html>
<html>
<head>
	<title>Space</title>
	   <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />

	   <style type="text/css">
	   	html, body {
		  	width:  100%;
		  	height: 100%;
		  	margin: 0px;
		  	background-color:#999999;
			color:#ffffff;
			overflow-x: hidden;
			overflow-y: hidden;
		}

		body {
		  position: relative;
		}

		td {
			width:100px;
			height:100px;
			border:1px solid #ffffff;
			text-align: center;
			line-height: .8;
		}
		canvas {
			background-color:#000000;
		}
		#shipConsole {
	    	margin:0 auto;
	    	overflow:scroll;
	    	overflow-y: hidden;
	    	overflow-x: hidden;
	    	background:#000000;
	    	color:#00ff00;
	    	width:200px;
	    	height:160px;
	    	padding:5px;
	    	font-family: monospace;
	    	text-align:left;
	    }
		@media only screen and (max-width: 500px) {
			.row {
				display: flex;
			}
		    #shipView {
		    	width:48% !important;
		    	height:50% !important;
		    	flex: 1;
		    	padding: 1em;
		    }
		    #shipConsole {
		    	width:48%;
		    	height:auto;
		    	max-height:auto;
		    	flex: 1;
		    	padding: 1em;
		    	padding:2px;
		    }
		}
	   </style>
</head>
<body style="text-align:center;">

	<div class="row">
		<canvas id="shipView">Your browser does not support the HTML5 canvas tag.</canvas>
		<!-- <div id="compass"></div> -->
		<div id="shipConsole"></div>
	</div>
	<input style="font-family: monospace;background-color:#000000; color:#00ff00;width:208px;outline:none;border:none;" autofocus id="user" type="text" name="user" autocomplete="off" value=""><br>

	<!-- <button onclick="switchOrientation()">Switch Orientation</button><br> -->
	<!-- <button onclick="rotateShape(1,'ROLL', -1)">&larr;</button>Roll<button onclick="rotateShape(-1,'ROLL', 1)">&rarr;</button><br>
	<button onclick="move(movArrArr[0]), shipRotation('YAW', -1)">&larr;</button>
	Yaw
	<button onclick="move(movArrArr[1]), shipRotation('YAW', 1)">&rarr;</button>
	<br>
	<button onclick="move(movArrArr[2]), shipRotation('PITCH', 1)">&uarr;</button>
	Pitch
	<button onclick="move(movArrArr[3]), shipRotation('PITCH', -1)">&darr;</button><br>
	<button onclick="accelerate()">Accelerate</button><input disabled onchange="" id="accelLock" type="checkbox"> -->
	<!-- <div><table id="fieldOfView"><tbody><tr><td id="t0-0"></td><td id="t0-1"></td><td id="t0-2"></td></tr><tr><td id="t1-0"></td><td id="t1-1"></td><td id="t1-2"></td></tr><tr><td id="t2-0"></td><td id="t2-1"></td><td id="t2-2"></td></tr></tbody></table></div> -->
	<!-- <br>Top Facing N or S :::::::::::::::::::: zAxis = UP, E, DOWN, W<br>
	<br>Top Facing UP or DOWN ::::::::: yAxis = N, E, S, W<br>
	<br>Top Facing E or W ::::::::::::::::::: xAxis = UP, S, DOWN, N<br> -->

<!-- <script src="js/planet.js"></script> -->
<script src="js/world.js"></script>

<script>
	var lastCommand = [];
	var commandChoice = -1;
	var user = document.getElementById("user");
	var cruiseControl = false;
	var isLanded = false;
	// [SOLARPOWER, IRON OXIDE, HYDROCARBON, HYDROXIDE, ETERNITY ORB]
	var inventory = [100,0,0,0,0];
	var alienConversation = false;
	var currentlyTrading = false;
	var harvestedLocations = [];
	user.addEventListener("keyup", function(event) {event.preventDefault();
		if (event.keyCode === 13) {
			lastCommand.unshift(document.getElementById('user').value);
			if (lastCommand.length>6) {
				lastCommand.splice(-1,1);
			}
			submitUserInput(document.getElementById('user').value);
			commandChoice = -1;
		}
		if (event.keyCode === 38) {
			if (commandChoice<lastCommand.length-1) {
				commandChoice = commandChoice+1;	
			}
			document.getElementById('user').value = lastCommand[commandChoice];
		}
		if (event.keyCode === 40) {
			if (commandChoice>0) {
				commandChoice = commandChoice-1;	
			}
			document.getElementById('user').value = lastCommand[commandChoice];
		}
	});

	function submitUserInput(x) {
		understandUserInput(x);
		document.getElementById("shipConsole").scrollTop = document.getElementById("shipConsole").scrollHeight;
		document.getElementById("user").value = "";
	};

	function understandUserInput(ui) {
		document.getElementById("shipConsole").innerHTML += "&dash;" + ui + "<br>";
		if (alienConversation && currentlyTrading) {return trading(ui)}
		else if (alienConversation) {return conversation(ui)};
		switch (ui.toLowerCase().replace(/\?|\!|\./g,'')) {
			case "yl":case "yaw left":
				if (!weCruisin && !isLanded) {
					computerReply("Yawing Left");
					move(movArrArr[0]);
					shipRotation('YAW',-1);
				}
				else {
					computerReply("Ignored");
				}
				break;
			case "yr":case "yaw right":
				if (!weCruisin && !isLanded) {
					computerReply("Yawing Right");
					move(movArrArr[1]);
					shipRotation('YAW',1);
				}
				else {
					computerReply("Ignored");
				}
				break;
			case "pu":case "pitch up":
				if (!weCruisin && !isLanded) {
					computerReply("Pitching Up");
					move(movArrArr[2]);
					shipRotation('PITCH',1);
				}
				else {
					computerReply("Ignored");
				}
				break;
			case "pd":case "pitch down":
				if (!weCruisin && !isLanded) {
					computerReply("Pitching Down");
					move(movArrArr[3]);
					shipRotation('PITCH',-1);	
				}
				else {
					computerReply("Ignored");
				}
				break;
			case "rl":case "roll left":
				if (!weCruisin && !isLanded) {
					computerReply("Rolling Left");
					rotateShape(1,'ROLL', -1);	
				}
				else {
					computerReply("Ignored");
				}
				break;
			case "rr":case "roll right":
				if (!weCruisin && !isLanded) {
					computerReply("Rolling Right");
					rotateShape(-1,'ROLL', 1);	
				}
				else {
					computerReply("Ignored");
				}
				break;
			case "accelerate":case "accel":
				if (!weCruisin && !isLanded) {
					if (worldArray[currentLocation-1] == "d" && direction == "DOWN") {
						computerReply("Error. Flying through shrapnel will damage craft.");
					}
					else if (worldArray[currentLocation-1] != "1" && direction == "DOWN") {
						computerReply("Error. Collision course detected.");
					}
					else {
						computerReply("Accelerating.");
						accelerate();
					}
				}
				else {
					computerReply("Ignored");
				}
				break;
			case "charge":
				if (worldArray[currentLocation-1] == "2") {
					computerReply("Charging...");
					computerReply("SOLAR ENERGY fully charged.", 1700);
					inventory[0] = 100;
				}
				else {
					computerReply("No energy source detected.");
				}
				break;
			case "land":
				if (!weCruisin) {
					if (!isLanded && (worldArray[currentLocation-1] == "3" || worldArray[currentLocation-1] == "5" || worldArray[currentLocation-1] == "6") && direction == "DOWN") {
						computerReply("Landing sequence initiated...");
						land(movArrArr[2]);
						isLanded = true;
						computerReply("Land sequence completed successfully. <br>Welcome to " + planetNamer(), 3800);
						computerReply(scanPlanet(),4200);

					}
					else if (isLanded) {
						computerReply("Error. We are currently landed.");
					}
					else {
						computerReply("Error. I am unable to detect a suitable landing surface.");
					}
				}
				break;
			case "launch":
				if (isLanded) {
					computerReply("Launching sequence initiated...", 700);
					setTimeout(function() {launch(movArrArr[3])}, 1700);
					computerReply("Launch sequence successful.", 5800);
					isLanded = false;
				}
				else {
					computerReply("Error. Already launched.");
				}
				break;
			case "cruise control on":case "cc on":
				cruiseControl=true;
				computerReply("Cruise control is enabled.");
				break;
			case "cruise control off":case "cc off":case "stop":case "s":
				cruiseControl=false;
				computerReply("Cruise control is disabled.");
				break;
			case "where am i":case "current location":case "location":case "where are we":case "position":case "current position":case "pos":case "loc":
				computerReply("We are currently at galacube " + currentLocation);
				break;
			case "help":case "controls":case "what":case "instructions":case "manual":case "commands":case "nav commands":
				computerReply("nav commands: ACCELERATE, YAW LEFT, YAW RIGHT, PITCH UP, PITCH DOWN, ROLL LEFT, ROLL RIGHT, CRUISE CONTROL ON, CRUISE CONTROL OFF, STOP or 'S', LAND, LAUNCH, FIRE, HAIL. Most commands have obvious shortcuts.");
				break;
			case "hello":case "hi":case "yo":case "howdy":case "good morning":case "good midday":case "good afternoon":case "good evening":
				computerReply(timeOfDay() + " Commander.");
				break;
			case "what is this":case "who are you":
				computerReply("ACCESS DENIED. Input 'help' for navigation commands.");
				break;
			case "direction":case "compass":case "dir":
				computerReply("We are facing " + direction);
				break;
			case "scan":
				if (isLanded) {computerReply(scanPlanet());}
				else {scanUniverse();};
				break;
			case "thanks":case "thanks you":case "okay thanks":
				computerReply("You're welcome.");
				break;
			case "open the pod bay doors":case "open the pod bay doors hal":
				computerReply("I'm afraid I can't do that, Commander.");
				break;
			case "time":case "what time is it":case "whats the time":
				computerReply(new Date());
				break;
			case "clear":
				document.getElementById("shipConsole").innerHTML = "";
				break;
			case "solar energy": case "energy":
				computerReply("SOLAR ENERGY: " + inventory[0] + "%");
				break;
			case "fire":
				if (!weCruisin) {
					solarBlaster();
					destroyObject(direction);
					inventory[0] = inventory[0] - 5;
					computerReply("SOLAR ENERGY: " + inventory[0] + "%",200);
				}
				else {
					computerReply("Error. Disable cruise control first.");
				}
				break;
			case "mine":case "harvest":case "dig":
				if (isLanded) {harvestResources();}else {computerReply("Error. Must be landed to harvest.");}
				break;
			case "hail":
				if (!weCruisin && !isLanded) {hail();}
				else {computerReply("Error.");};
				break;
			case "":
				break;
			default:
				computerReply("Does not compute.");
		}
	};

	function computerReply(reply, time) {
		if (!time) {time = 700;};
		return setTimeout(function(){document.getElementById("shipConsole").innerHTML += reply + "<br>"; document.getElementById("shipConsole").scrollTop = document.getElementById("shipConsole").scrollHeight;}, time);
	}
	function scanUniverse() {
		// var objectFound = false;
		var xi = 1;
		document.getElementById("shipConsole").innerHTML += "scanning...<br>";
		while (xi<10) {
			if (loopView(currentLocation-(xi*x))!="1") {
				return computerReply("The nearest object is NORTH");
			}
			else if (loopView(currentLocation+(xi*x))!="1") {
				return computerReply("The nearest object is SOUTH");
			}
			else if (loopView(currentLocation-(xi*z))!="1") {
				return computerReply("The nearest object is WEST");
			}
			else if (loopView(currentLocation+(xi*z))!="1") {
				return computerReply("The nearest object is EAST");
			}
			else if (loopView(currentLocation-(xi*y))!="1") {
				return computerReply("The nearest object is UP");
			}
			else if (loopView(currentLocation+(xi*y))!="1") {
				return computerReply("The nearest object is DOWN");
			}
			else {
				xi = xi + 1;
			}
		}
		return computerReply("Scan unable to locate nearby objects");
	};

	function timeOfDay() {
		switch (true) {
			case new Date().getHours() >= 5 && new Date().getHours() < 11:
				return "Good morning";
				break;
			case new Date().getHours() >= 11 && new Date().getHours() < 14:
				return "Good day";
				break;
			case new Date().getHours() >= 14 && new Date().getHours() < 18:
				return "Good afternoon";
				break;
			case new Date().getHours() >= 18 || new Date().getHours() < 5:
				return "Good evening";
				break;
			default:
				return "Hello";
				break;
		}
	};
	function harvestResources() {
	if (harvestedLocations.indexOf(currentLocation.toString(36)) == -1){
		if (rgbGenerateFromCurPos(currentLocation)[0] > rgbGenerateFromCurPos(currentLocation)[1] && rgbGenerateFromCurPos(currentLocation)[0] > rgbGenerateFromCurPos(currentLocation)[2]) {
				harvestedLocations.push(currentLocation.toString(36));
				if (rgbGenerateFromCurPos(currentLocation)[0] > 200) {inventory[1] = inventory[1] + (Math.floor(Math.random() * 9) + 15);return computerReply("IRON OXIDE: " + inventory[1]);}
				else if (rgbGenerateFromCurPos(currentLocation)[0] > 110) {inventory[1] = inventory[1] + (Math.floor(Math.random() * 9) +9);return computerReply("IRON OXIDE: " + inventory[1]);}
				else {inventory[1] = inventory[1] + (Math.floor(Math.random() * 9) + 3);return computerReply("IRON OXIDE: " + inventory[1]);};
			}
			else if (rgbGenerateFromCurPos(currentLocation)[1] > rgbGenerateFromCurPos(currentLocation)[0] && rgbGenerateFromCurPos(currentLocation)[1] > rgbGenerateFromCurPos(currentLocation)[2]) {
				harvestedLocations.push(currentLocation.toString(36));
				if (rgbGenerateFromCurPos(currentLocation)[1] > 200) {inventory[2] = inventory[2] + (Math.floor(Math.random() * 9) + 15); return computerReply("HYDROCARBON: " + inventory[2]);}
				else if (rgbGenerateFromCurPos(currentLocation)[1] > 110) {inventory[2] = inventory[2] + (Math.floor(Math.random() * 9) + 9); return computerReply("HYDROCARBON: " + inventory[2]);}
				else {inventory[2] = inventory[2] + (Math.floor(Math.random() * 9) + 3); return computerReply("HYDROCARBON: " + inventory[2]);};
			}
			else if (rgbGenerateFromCurPos(currentLocation)[2] > rgbGenerateFromCurPos(currentLocation)[0] && rgbGenerateFromCurPos(currentLocation)[2] > rgbGenerateFromCurPos(currentLocation)[1]) {
				harvestedLocations.push(currentLocation.toString(36));
				if (rgbGenerateFromCurPos(currentLocation)[2] > 200) {inventory[3] = inventory[3] + (Math.floor(Math.random() * 9) + 15); return computerReply("HYDROXIDE: " + inventory[3]);}
				else if (rgbGenerateFromCurPos(currentLocation)[2] > 110) {inventory[3] = inventory[3] + (Math.floor(Math.random() * 9) + 9); return computerReply("HYDROXIDE: " + inventory[3]);}
				else {inventory[3] = inventory[3] + (Math.floor(Math.random() * 9) + 3); return computerReply("HYDROXIDE: " + inventory[3]);};
			}
			else {harvestedLocations.push(currentLocation.toString(36));inventory[4] = inventory[4] + 1;return computerReply("ETERNITY ORB: " + inventory[4]);};}
		else {computerReply("Planet fully harvested.");};
	};

	function destroyObject(dx) {
		switch (dx) {
			case "N":
				var xi = 1;
				while (xi<3) {
					if (loopView(currentLocation-(xi*x))=="2" || loopView(currentLocation-(xi*x))=="3" || loopView(currentLocation-(xi*x))=="4") {return;}
					else if (loopView(currentLocation-(xi*x))=="a" || loopView(currentLocation-(xi*x))=="z" || loopView(currentLocation-(xi*x))=="x") {return spliceWorldArray(currentLocation-(xi*x)-1,"d")}
					else {xi = xi + 1;}
				}
				break;
			case "S":
				var xi = 1;
				while (xi<3) {
					if (loopView(currentLocation+(xi*x))=="2" || loopView(currentLocation+(xi*x))=="3" || loopView(currentLocation+(xi*x))=="4") {return;}
					else if (loopView(currentLocation+(xi*x))=="a" || loopView(currentLocation+(xi*x))=="z" || loopView(currentLocation+(xi*x))=="x") {return spliceWorldArray(currentLocation+(xi*x)-1,"d")}
					else {xi = xi + 1;}
				}
				break;
			case "W":
				var xi = 1;
				while (xi<3) {
					if (loopView(currentLocation-(xi*z))=="2" || loopView(currentLocation-(xi*z))=="3" || loopView(currentLocation-(xi*z))=="4") {return;}
					else if (loopView(currentLocation-(xi*z))=="a" || loopView(currentLocation-(xi*z))=="z" || loopView(currentLocation-(xi*z))=="x") {return spliceWorldArray(currentLocation-(xi*z)-1,"d")}
					else {xi = xi + 1;}
				}
				break;
			case "E":
				var xi = 1;
				while (xi<3) {
					if (loopView(currentLocation+(xi*z))=="2" || loopView(currentLocation+(xi*z))=="3" || loopView(currentLocation+(xi*z))=="4") {return;}
					else if (loopView(currentLocation+(xi*z))=="a" || loopView(currentLocation+(xi*z))=="z" || loopView(currentLocation+(xi*z))=="x") {return spliceWorldArray(currentLocation+(xi*z)-1,"d")}
					else {xi = xi + 1;}
				}
				break;
			case "UP":
				var xi = 1;
				while (xi<3) {
					if (loopView(currentLocation-(xi*y))=="2" || loopView(currentLocation-(xi*y))=="3" || loopView(currentLocation-(xi*y))=="4") {return;}
					else if (loopView(currentLocation-(xi*y))=="a" || loopView(currentLocation-(xi*y))=="z" || loopView(currentLocation-(xi*y))=="x") {return spliceWorldArray(currentLocation-(xi*y)-1,"d")}
					else {xi = xi + 1;}
				}
				break;
			case "DOWN":
				var xi = 0;
				while (xi<3) {
					if (loopView(currentLocation+(xi*y))=="2" || loopView(currentLocation+(xi*y))=="3" || loopView(currentLocation+(xi*y))=="4") {return;}
					else if (loopView(currentLocation+(xi*y))=="a" || loopView(currentLocation+(xi*y))=="z" || loopView(currentLocation+(xi*y))=="x") {return spliceWorldArray(currentLocation+(xi*y)-1,"d")}
					else {xi = xi + 1;}
				}
				break;
			default:
				break;
		}
	};

	function spliceWorldArray(where, withWhat) {
		var tempArray;
		tempArray = [worldArray.substring(0, where),worldArray.substring(where, where+1),worldArray.substring(where+1)];
		tempArray.splice(1,1,withWhat);
		return worldArray = tempArray.join("");
	};

	function scanPlanet() {
		computerReply("Scanning");
		if (worldArray[currentLocation-1] == "3") {
			if (rgbGenerateFromCurPos(currentLocation)[0] > rgbGenerateFromCurPos(currentLocation)[1] && rgbGenerateFromCurPos(currentLocation)[0] > rgbGenerateFromCurPos(currentLocation)[2]) {
				return "Planet is primarily IRON OXIDE.";
			}
			else if (rgbGenerateFromCurPos(currentLocation)[1] > rgbGenerateFromCurPos(currentLocation)[0] && rgbGenerateFromCurPos(currentLocation)[1] > rgbGenerateFromCurPos(currentLocation)[2]) {
				return "Planet is primarily HYDROCARBON.";
			}
			else if (rgbGenerateFromCurPos(currentLocation)[2] > rgbGenerateFromCurPos(currentLocation)[0] && rgbGenerateFromCurPos(currentLocation)[2] > rgbGenerateFromCurPos(currentLocation)[1]) {
				return "Planet is primarily HYDROXIDE.";
			}
			else {
				return "Unable to accurately scan.";
			}
		}
		
	};

	function planetNamer() {
		var sp = currentLocation.toString().split("");
		var v1 = ['br','','cr','dr','','fr','gr','','pr','','str','','tr','bl','','cl','fl','','gl','','pl','sl','sc','sk','sm','sn','sp','st','sw','ch','','sh','th','wh','','ex','b','c','d','','f','g','h','','i','j','','k','l','m','n','','p','q','r','s','t','','v','w','x','y','z'];
		var vv = ['a','ae','ai','ao','au','e','ea','ee','ei','eo','eu','i','ia','ie','io','iu','o','oa','oe','oi','oo','ou','u','ua','ue','ui','uo'];
		var v2 = ['th','','he','an','','in','','er','on','re','','ed','nd','ha','','at','en','es','','of','nt','','ti','','to','le','','is','','ou','ar','','as','de','rt','','ve','the','','and','tha','','ent','ion','tio','for','nde','has','nce','tis','oft','men',''];
		var name = v1[(findLetter(0) + findLetter(1) + findLetter(3) + findLetter(4) + findLetter(5) + findLetter(6) + findLetter(7))%v1.length] + "" + vv[(findLetter(5) + findLetter(4) + findLetter(3))%vv.length] + "" + v2[(findLetter(0) + findLetter(2) + findLetter(5) + findLetter(4))%v2.length];
		// console.log(name.charAt(0).toUpperCase() + name.substr(1));
		// console.log(v1.length + " " + vv.length + " " + v2.length);
		function findLetter(num) {
			if (sp[num]) {
				return Number(sp[num]);	
			}
			else return "";
		}
		return name.toUpperCase();
	};

	function takeDamage(howMuch){
		clearInterval(stalled);
		var c = 1;
		inventory[0] = inventory[0] - howMuch;
		disableButtons(true);
		var movement = setInterval(function() {
			c = c+1;
		  	// ctx.clearRect(0,0,1000,1000);
		  	ctx.beginPath();
		  	ctx.fillStyle = "rgba(150, 150, 255, .1)";
			ctx.fillRect(0,0,1000,1000);
			ctx.closePath();
		  if (c > 20) clearInterval(movement),staticArt(),disableButtons(false),drawField(currentLocation, fm, um, lm),stalled = setInterval(generalState, 30);
		}, 15);
	};
	


var counts = {};

for (var i = 0; i < worldArray.length; i++) {
  var num = worldArray[i];
  counts[num] = counts[num] ? counts[num] + 1 : 1;
};

console.log("empty stars land gas aliens totalsize\n",counts[1], counts[2], counts[3], counts[4], counts['z']+counts['x'], worldArray.length);
computerReply("You're finally awake.<br>System booting...");
computerReply(timeOfDay() + " Commander. All systems go. Type 'help' for nav commands.", 2200);
	
</script>

<script src="js/hail.js"></script>


</body>
</html>
